---
layout: article
title: I/O Hardware
author: J_å®‹
tags: OperatingSystem í•œê¸€
mathjax: true
key: operatingSystem06
---



### I/O Hardware

#### Inside I/O Device

 <img src="/assets/images/æ“ä½œç³»ç»Ÿ/pic06/Screen Shot 2021-09-14 at 12.46.16 PM.png" alt="Screen Shot 2021-09-14 at 12.46.16 PM" style="zoom: 50%;" />

- Status Register : ì¥ì¹˜ì˜ ìƒíƒœë¥¼ ë³´ì—¬ì£¼ëŠ” Register
- Control Register : ì¥ì¹˜ì˜ ë™ì‘ì„ ê²°ì •í•˜ëŠ” Register
- Data Register : ì…ì¶œë ¥í•  ë°ì´í„°ë¥¼ ì ì‹œ ë³´ê´€í•˜ëŠ” Register

- I/O Deviceì˜ Registerì— ì ‘ê·¼í•˜ëŠ” ë‘ê°€ì§€ ë°©ë²• :
  1. Memory mapped I/O
  2. Port mapped I/O

- OSê°€ I/O Deviceë¥¼ ì œì–´í•œë‹¤ëŠ” ê²ƒì€ I/O Deviceì— ìˆëŠ” Registerë“¤ì„ Programmingí•œë‹¤ëŠ” ê²ƒì„



#### I/O Devicesì˜ ë¶„ë¥˜

[1] Character Devices : Data transferê°€ Characterë‹¨ìœ„ë¡œ ì´ë¤„ì§

- Mouse
  - OSì™€ Mouse driverì˜ ë™ì‘
    1. Background Applicationì´ mouse ì›€ì§ì´ë‚˜ í´ë¦­ì„ ê¸°ë‹¤ë¦¼ 
    2. mouse ì›€ì§ì´ë‚˜ í´ë¦­ì´ packetí˜•íƒœë¡œ Mouse driverì—ê²Œ ì „ë‹¬
    3. Mouse driverëŠ” OSì—ê²Œ Mouse eventì˜ ì¡´ì¬ë¥¼ ì•Œë¦¬ê¸° ìœ„í•´ event queueì— ë„£ê²Œë¨
    4. OSëŠ” ì‹œê°„ì´ ë‚  ë•Œ ë§ˆë‹¤ notifyë¥¼ ë°›ì•„ì„œ event queueì— ì ‘ê·¼í•´ eventì— ëŒ€í•œ handlingì„ í•˜ê²Œë¨ 
  - Mouse Driverì˜ ì—­í•  ìš”ì•½ 
    - Mouse Interrupt ë°œìƒ ì‹œ, Mouseì˜ Data Registerì—ì„œ ê°’ì„ ì½ì–´ì˜¤ëŠ” ì—­í• 
    - Interruptë¥¼ Eventë¡œ ë°”ê¾¸ì–´ ì£¼ëŠ” ì—­í• 
- Terminal
  - Keyboard Driverì˜ ì—­í•  ìš”ì•½
    - Keyboardë¡œ ë¶€í„° ë“¤ì–´ì˜¤ëŠ” ê° Characterë“¤ì„ Line Bufferì— ìˆœì„œëŒ€ë¡œ ì €ì¥
    - End-of-Line Characterê°€ ë“¤ì–´ì˜¤ë©´ ì „ì²´ Line Bufferë¥¼ OSì—ê²Œ ì „ë‹¬

[2] Block Devices : Data transferê°€ Blockë‹¨ìœ„ë¡œ ì´ë¤„ì§

- Disk drive

  - í•˜ë“œì›¨ì–´ Accessê°€ ms ë‹¨ìœ„ë¡œ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì´ìœ  : 
    - Seek time (Disk Armì„ ëª©í‘œ Trackê¹Œì§€ ì´ë™í•˜ëŠ”ë° ê±¸ë¦¬ëŠ” ì‹œê°„)ì´ ê¸¸ì–´ì„œ

- Flash drive

  - NAND Flash MemoryëŠ” RAMê³¼ Access Patternì´ ë‹¤ë¥´ë‹¤

     <img src="/assets/images/æ“ä½œç³»ç»Ÿ/pic06/12-17 screenshot.png" alt="12-17 screenshot" style="zoom:80%;" />

    - ìš”ê¸°ì„œ PageëŠ” Memory Managementì—ì„œ Pageì™€ ë‹¤ë¦„

  - Flashì˜ Operation :

    1. Read Operation (í•œ Pageë¥¼ í†µì±„ë¡œ ì½ì–´ì˜´) : ìˆ˜í–‰ì‹œê°„ì´ ë¹ ë¦„
    2. Program(Write) Operation 
    3. Erase Operation : FlashëŠ” ROMì´ê¸° ë•Œë¬¸ì— Rewriteì´ ì•ˆëœë‹¤. ê·¸ë˜ì„œ Writeì„ í•˜ê¸° ìœ„í•´ì„œëŠ” ë¨¼ì € dataë¥¼ eraseí•œ í›„ì— writeë¥¼ í•´ì•¼ë¨. ìˆ˜í–‰ì‹œê°„ì´ ì œì¼ ëŠë¦¼

  - Read/Write operationì˜ ë‹¨ìœ„ëŠ” Pageì´ê³  Eraseì˜ ë‹¨ìœ„ëŠ” Blockì´ë‹¤

  - Worn-out : Erase ê°€ëŠ¥í•œ íšŸìˆ˜ì— ì œí•œì´ ì¡´ì¬í•¨

  - Wear-leveling : NAND Flashì˜ í•œ ì˜ì—­ì— Eraseê°€ ì§‘ì¤‘ë˜ì–´ Worn-outì´ ë°œìƒí•˜ëŠ” ê²ƒì„ ë§‰ê¸° ìœ„í•´ ì „ì²´ ì˜ì—­ì„ ê³ ë£¨ ì‚¬ìš©í•˜ë„ë¡ ì¡°ì ˆí•˜ëŠ” ê¸°ìˆ  

  - Log structure

     <img src="/assets/images/æ“ä½œç³»ç»Ÿ/pic06/Screen Shot 2021-09-14 at 4.51.31 PM.png" alt="Screen Shot 2021-09-14 at 4.51.31 PM" style="zoom:33%;" />

    - Page 1ì˜ ë‚´ìš©ì„ updateí•˜ê³  ì‹¶ì€ë° Blockë‹¨ìœ„ì˜ Eraseë¥¼ í•˜ë©´ Data Blockì˜ ë‹¤ë¥¸ Page ë‚´ìš©ë„ ê°™ì´ ì—†ì–´ì§€ê¸° ë•Œë¬¸ì— Log Blockì—ë‹¤ updateë‚´ìš©ì„ ì ê³  Logical Page Numberë¡œ 1ì„ ë¶€ì—¬í•œë‹¤. ê·¸ë¦¬ê³  Data blockì— ìˆëŠ” ì˜›ë‚  PageëŠ” invalidateí•œë‹¤
    - ë°˜ë“œì‹œ Remappingí•´ì£¼ëŠ” ì‘ì—…ì´ í•„ìš”í•¨

[3] Network Devices

- NIC (Network interface card)



#### Device Driver

- Device Driver : ë‹¤ë¥¸ í”„ë¡œê·¸ë¨ë“¤ì´ ì–´ë–¤ Hardware deviceë¥¼ ì˜ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” Computer program

  - OSì™€ Deviceì‚¬ì´ì— ìœ„ì¹˜í•˜ëŠ” Software
  - ë³µì¡í•œ Deviceë“¤ì˜ íŠ¹ì„±ë“¤ì„ ë‹¤ ì†Œí™”í•´ì„œ Userë“¤ì—ê²Œ ì¶”ìƒí™”ëœ Operation interfaceë¥¼ ì œê³µí•´ì¤Œ
    - UNIXê³„ì—´ì˜ Device Driverì—ì„œì˜ Operationë“¤ 
      1. Open : Deviceë¥¼ ì´ˆê¸°í™”(OSê´€ì ì—ì„œ ê·¸ Deviceë¥¼ Registerì™€ Device Driverê°€ í•„ìš”í•œ data structureë¥¼ ì¡ì•„ì£¼ëŠ” ì¼)í•˜ëŠ” ê¸°ëŠ¥
      2. Close : ê·¸ Device Driverê°€ ì°¨ì§€í•˜ë˜ ê³µê°„ë“¤ì„ ë‹¤ release í•˜ëŠ” ê¸°ëŠ¥
      3. Read : Input
      4. Write : Output
      5. ioctl : I/O control
  - UNIXì—ì„œ ë°”ë¼ë³´ëŠ” Device Type
    1. Character Device : ì£¼ë¡œ sequencial access
       - console, keyboard, mouse, â€¦ (/dev/tty1, /dev/lp1, â€¦)
    2. Block Device : ì£¼ë¡œ random access
       - hard disk drive, CD-ROM drive, â€¦ (/dev/hda1, â€¦)
       - *Block Buffer Cache*ë¥¼ ê°€ì§€ê³  ìˆìŒ (CPUì— ë¹„í•´ ìƒëŒ€ì ìœ¼ë¡œ ì†ë„ê°€ ëŠë¦° Block Deviceì˜ ì„±ëŠ¥ì„ ë³´ì™„í•´ì¤€ë‹¤)
    3. Network Interfaces

- UNIX OSì—ì„œ File systemì´ ì œê³µí•˜ëŠ” ì—­í• 

  [1] Diskì— ìˆëŠ” dataë¥¼ ì½ê±°ë‚˜ ì“¸ ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µ

  [2] Fileì´ë‚˜ Deviceì™€ ê°™ì€ System ìì›ë“¤ì—ê²Œ Name Spaceë¥¼ ì œê³µ

- Device File : UNIX OSì—ì„œ íŠ¹ìˆ˜í•œ fileì„ ìƒì„±í•´ì„œ fileê³¼ deviceë¥¼ ì—°ê²°ì‹œì¼œ ë†“ì€ ê²ƒ

  - directory : `/dev`

  - ë™ì¼í•œ deviceì—ê²Œ ì„œë¡œ ë‹¤ë¥¸ device driverë¥¼ ì œê³µí•  ìˆ˜ ìˆë‹¤

  - Device Fileì˜ ë‚´ìš©ë¬¼(content) :

    1. Real Data : ë§ ê·¸ëŒ€ë¡œ Character content

    2. Meta Data : Fileì˜ íŠ¹ì„±ì„ í‘œí˜„í•˜ëŠ” ë¶€ê°€ì ì¸ Data

        <img src="/assets/images/æ“ä½œç³»ç»Ÿ/pic06/Screen Shot 2021-09-15 at 10.40.36 AM.png" alt="Screen Shot 2021-09-15 at 10.40.36 AM" style="zoom:40%;" />

       - Major : ì–´ë–¤ Typeì˜ Deviceì¸ê°€ë¥¼ ë‚˜íƒ€ëƒ„

       - Minor : device driverì— ì—¬ëŸ¬ routineì„ í˜¸ì¶œí•  ë•Œ ë„ˆì˜ ëŒ€ìƒì´ ë˜ëŠ” deviceë¥¼ ì°¾ìœ¼ë¼ê³  aurgmentë¡œ ì „ë‹¬ í•´ì¤Œ

         ğŸ§ ***Interesting fact*** : 

         - The United Statesâ€™ nuclear arsenal will no longer rely on a computer system that uses ***eight-inch floppy disks*** [2019/10/24]

         - Pentagon was one of the several government agencies whose computer systems relied on â€œoutdated software languages and hardware parts that are unsupported,â€ some of which were â€œat least 50 years old.â€
         - Upside of relying on such old technology : the systems are not connected to the internet, they are exceptionally secure (Hackers canâ€™t break into a floppy disk)

- Character Device Drivers

   <img src="/assets/images/æ“ä½œç³»ç»Ÿ/pic06/Screen Shot 2021-09-15 at 11.13.02 AM.png" alt="Screen Shot 2021-09-15 at 11.13.02 AM" style="zoom: 50%;" />

  - `open("/dev/...")` ì„ í•˜ê²Œ ë˜ë©´ OSì´ Device fileì„ ì½ì–´ì„œ í•´ë‹¹ Device tableì—ì„œ Fileì˜ major numberì™€ ì¼ì¹˜í•˜ëŠ” entryë¥¼ ì°¾ì•„ì„œ open function pointerë¥¼ ì–»ì–´ì„œ ì‹¤ì œë¡œ í˜¸ì¶œí•¨
  - File system ì…ì¥ì—ì„œ Data fileì´ open ë¬ìœ¼ë©´ ê·¸ ëª©ì ì€ Disk driveì—ì„œ blockì„ read/writeí•˜ëŠ” ê±´ë° Device fileì„ opení•œë‹¤ëŠ” ê²ƒì€ Open,Close,Read,Write,ioctl ë“±ì˜ í•¨ìˆ˜ë“¤ì„ í˜¸ì¶œí•˜ëŠ” ê²ƒ

- Block Device Drivers

   <img src="/assets/images/æ“ä½œç³»ç»Ÿ/pic06/Screen Shot 2021-09-15 at 11.27.35 AM.png" alt="Screen Shot 2021-09-15 at 11.27.35 AM" style="zoom: 33%;" />

  - Device Driverê°€ Buffer cacheë¥¼ manageí•˜ëŠ” ë²•

    1. ì‚¬ìš©ìê°€ `read()` system callì„ í–ˆë‹¤ë©´ Block read ëª…ë ¹ìœ¼ë¡œ ë‚´ë¶€ì ìœ¼ë¡œ ë³€í™˜ì´ ë¨
    2. Block read ëª…ë ¹ëŠ” ìš°ì„  Buffer cacheë¥¼ ì ‘ê·¼ì„ í•¨

    3-a. ë§Œì•½ Buffer cacheë‚´ì— ì›í•˜ëŠ” Blockì´ ì¡´ì¬í•˜ë©´ ê±°ê¸°ì„œ ë°”ë¡œ ê°€ì ¸ì˜´

    3-b. ë§Œì•½ Buffer cacheë‚´ì— ì›í•˜ëŠ” Blockì´ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´

    â€‹	3-b[1]. Block I/O requestê°€ í˜•ì„±

    â€‹	3-b[2]. ê´€ë ¨ Deviceì— ì†Œì†ëœ Request Queueë¡œ ëª…ë ¹ì´ ë“¤ì–´ê°

    â€‹	3-b[3]. Device Driverê°€ ì œê³µí•˜ëŠ” Schedulerì— ì˜í•´ì„œ Queueì— ìˆëŠ” Requestë“¤ì´ dequeueë˜ì–´ ì‹¤í–‰

    

- Interrupt Handling in Device Drivers Drivers

  - Two-level processing : Linuxì—ì„œ Device Interrupt ì²˜ë¦¬

    - Interrupt Service Routineì´ í˜¸ì¶œë˜ëŠ” ë™ì•ˆ, ë™ì¼í•œ ì—¬ëŸ¬ Interruptê°€ ë„ì°©í•  ê²½ìš° Synchronization ë¬¸ì œê°€ ë°œìƒí•˜ê¸° ë•Œë¬¸ì—  HandlerëŠ” ìµœì†Œí•œ ìê¸°ì™€ ë™ë“±í•œ ìˆ˜ì¤€ì˜ Interruptë“¤ì„ Disable ì‹œí‚´

    - ë¨¼ì € Interruptê°€ ë°œìƒí•˜ë©´ Handlerê°€ ëœ¨ê²Œëœë‹¤. ê·¸ëŸ¼ ìê¸°ê°€ ìˆ˜í–‰í•´ì•¼ë˜ëŠ” ìµœì†Œí•œë§Œ ìˆ˜í–‰í•˜ê³  ë‚˜ë¨¸ì§€ ì¤‘ìš”í•œ Logicì€ Kernel Thread í˜•íƒœë¡œ ë˜ëŠ” User process í˜•íƒœë¡œ ë”°ë¡œ ëˆë‹¤

    - Interrupt Handlerì˜ ì—­í•  :  

      - ë¨¼ì € Interruptë¥¼ Disable ì‹œí‚´
      - ì—¬ëŸ¬ OSì˜ ë¯¼ê°í•œ issueë“¤ì„ ë¨¼ì € ì²˜ë¦¬í•´ì£¼ê³  ë‚˜ë¨¸ì§€ logicì€ Bottom half í˜•íƒœë¡œ ë§Œë“¤ì–´ì„œ Bottom half  Queueì— ë„£ëŠ”ë‹¤
      - Bottom halfëŠ” ì‹œê°„ì´ ë‚  ë•Œ scheduling ë˜ë©°, Interruptê°€ Enableëœ ìƒíƒœì—ì„œ ëŒê²Œë¨

    - Bottom half

       <img src="/assets/images/æ“ä½œç³»ç»Ÿ/pic06/Screen Shot 2021-09-15 at 12.08.57 PM.png" alt="Screen Shot 2021-09-15 at 12.08.57 PM" style="zoom:40%;" />

      - Bottom halfê°€ ëŒ ë•ŒëŠ” 1ê°œë§Œ ëˆë‹¤ : ì™œëƒí•˜ë©´ í•œë²ˆì— ë– ì„œ ì—¬ëŸ¬ interruptì˜ Bottom half requestë¥¼ í•œëª©ì— ì²˜ë¦¬í•˜ê¸° ìœ„í•´ì„œ

- Device Driver ì œê³µí•˜ëŠ” functionë“¤ 

  [1] open : 

  - Minor numberë¥¼ ì°¾ì•„ì˜´
  - ì ì ˆí•œ deviceë¥¼ initializeí•œë‹¤ 
  - deviceë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ opení•œ processì˜ ê°œìˆ˜ë¥¼ counterì— ë”í•¨ 
    - ë‚˜ì¤‘ì— closeí•œ processëŠ” counterì—ì„œ ëºŒ
    - counterê°€ 0ì´ ë  ê²½ìš° ì „ì— í• ë‹¹ë°›ì€ data structureë¥¼ releaseí•¨
  - íŠ¹ì • Interrupt handlerë¥¼ íŠ¹ì • IRQì™€ ì—°ë™ì‹œì¼œì„œ Interrupt vector tableì— ë“±ë¡í•¨

  [2] read/write :

  - Pooling I/O vs Interrupt Driven I/O :

    - Pooling I/O : ì£¼ê¸°ì ìœ¼ë¡œ Device driverê°€ data registerì— ì½ì–´ê°ˆ ê°’ì´ ìˆëŠ”ì§€ Check í•´ë³´ëŠ”ê±° (ì •í™•í•˜ê²ŒëŠ” Ready flag bitë¥¼ í™•ì¸)
    - Interrupt Driven I/O : ì£¼ë„ê¶Œì„ Deviceë¥¼ ê°€ì§€ê³  ìˆì–´ì„œ Deviceê°€ dataë¥¼ ì½ì–´ì˜¤ë©´ data registerì—ë‹¤ ì“°ê³  CPUí•œí…Œ interruptë¥¼ ê±´ë‹¤

  - Blocking I/O vs Non-Blocking I/O :

    - Blocking I/O : Pooling I/Oì˜ ê²½ìš° readyì¸ì§€ ê³„ì† flag bit checkë¥¼ ë°˜ë³µ

    - Non-Blocking I/O : Pooling I/Oì˜ ê²½ìš° readyì¸ì§€ flag bit  checkí•œ ë‹¤ìŒ readê°€ ì•„ë‹ˆë©´ operationì„ ë°”ë¡œ terminate

      ğŸ’ğŸ» Embedded System, Real Time Systemì—ì„œëŠ” Non-Blocking I/Oë¥¼ ì‚¬ìš©





***

ã€ŠReferenceã€‹

1. <a href="https://youtube.com/playlist?list=PL_1QkD8uy-Nal28iaDIZAIrPfCcJeSuj3">SNUON Youtube</a>

2. <a href="https://www.nytimes.com/2019/10/24/us/nuclear-weapons-floppy-disks.html">Interesting fact</a>

***

